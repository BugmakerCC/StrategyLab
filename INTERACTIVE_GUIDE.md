# 📊 交互式量化回测系统使用指南

## 🎯 功能特性

这是一个功能强大的Web交互式回测系统，整合了 `strategy_optimizer.py` 和 `multi_crypto_backtest.py` 的所有功能，并提供了友好的图形界面。

### ✨ 主要功能

- **5种加密货币**: BTC, ETH, BNB, SOL, DOGE
- **5种交易策略**: RSI均值回归、移动平均线交叉、布林带突破、MACD、动量突破
- **灵活参数调整**: 每个策略都有可调节的参数
- **多周期回测**: 支持1个月到2年的历史数据
- **实时可视化**: 交互式图表展示价格、信号、指标
- **详细绩效**: 总收益、夏普比率、最大回撤、胜率等
- **交易记录**: 完整的买卖记录表

---

## 🚀 快速开始

### 1️⃣ 安装依赖

```bash
pip install streamlit yfinance plotly pandas numpy
```

### 2️⃣ 启动应用

**方式1 - 使用脚本（推荐）：**
```bash
./run_interactive.sh
```

**方式2 - 手动启动：**
```bash
streamlit run interactive_backtest.py
```

### 3️⃣ 访问界面

浏览器会自动打开，或手动访问：
```
http://localhost:8501
```

---

## 📖 使用教程

### 界面布局

```
┌─────────────────────────────────────────────────┐
│  侧边栏（左侧）          │  主界面（右侧）       │
│  ├─ 加密货币选择         │  ├─ 绩效指标          │
│  ├─ 回测周期             │  ├─ 可视化图表        │
│  ├─ K线级别              │  └─ 交易记录          │
│  ├─ 策略选择             │                        │
│  ├─ 策略参数             │                        │
│  └─ 🚀 运行回测按钮      │                        │
└─────────────────────────────────────────────────┘
```

### 操作步骤

#### 1. 选择加密货币
在侧边栏顶部选择要回测的币种：
- **BTC-USD**: 比特币
- **ETH-USD**: 以太坊
- **BNB-USD**: 币安币
- **SOL-USD**: Solana
- **DOGE-USD**: 狗狗币

#### 2. 选择回测周期
- **1mo**: 1个月（适合短期策略）
- **3mo**: 3个月
- **6mo**: 6个月（推荐）
- **1y**: 1年
- **2y**: 2年（适合长期策略）

#### 3. 选择K线级别
- **1d**: 日线（推荐，数据稳定）
- **4h**: 4小时线
- **1h**: 小时线（数据量大）

#### 4. 选择策略

##### 策略 1: RSI均值回归 ⭐️ 推荐
**原理**: 当RSI低于超卖线时买入，高于超买线时卖出

**参数**:
- RSI周期 (默认: 14)
- 超卖线 (默认: 35) - 越低越激进
- 超买线 (默认: 80) - 越低越保守

**适用场景**: 震荡市场，适合BTC/ETH

##### 策略 2: 移动平均线交叉
**原理**: 短期均线上穿长期均线时买入（金叉），下穿时卖出（死叉）

**参数**:
- 短期均线 (默认: 5日)
- 长期均线 (默认: 20日)
- 趋势过滤 (推荐开启)

**适用场景**: 趋势市场

##### 策略 3: 布林带突破
**原理**: 价格跌破下轨时买入，突破上轨时卖出

**参数**:
- 布林带周期 (默认: 20)
- 标准差倍数 (默认: 2)

**适用场景**: 高波动市场

##### 策略 4: MACD
**原理**: MACD线上穿信号线时买入，下穿时卖出

**参数**:
- 快线周期 (默认: 12)
- 慢线周期 (默认: 26)
- 信号线周期 (默认: 9)

**适用场景**: 中长期趋势

##### 策略 5: 动量突破
**原理**: 价格突破N日高点时买入，跌破N日低点时卖出

**参数**:
- 回看周期 (默认: 20)
- 突破阈值 (默认: 2%)

**适用场景**: 强趋势市场

#### 5. 调整参数

每个策略都有独特的参数，可以通过滑块调整：
- 向左滑动：更保守
- 向右滑动：更激进

#### 6. 运行回测

点击 **🚀 运行回测** 按钮，系统会：
1. 获取历史数据
2. 计算技术指标
3. 生成交易信号
4. 执行模拟交易
5. 计算绩效指标
6. 生成可视化图表

---

## 📊 结果解读

### 绩效指标

| 指标 | 说明 | 理想值 |
|------|------|--------|
| **总收益率** | 策略的总体收益百分比 | > 0% |
| **最终资金** | 从$10,000起始的最终资金 | > $10,000 |
| **夏普比率** | 风险调整后的收益率 | > 1.0 |
| **最大回撤** | 最大资金回撤百分比 | < -20% |
| **交易次数** | 总交易次数 | 适中（5-20次） |
| **胜率** | 盈利交易占比 | > 50% |
| **买入持有收益** | 买入后一直持有的收益 | 参考基准 |
| **vs 市场** | 是否跑赢买入持有策略 | ✅ 跑赢 |

### 可视化图表

图表分为3个子图：

**子图1: 价格走势与交易信号**
- 蓝色线：收盘价
- 灰色区域：高低价区间
- 🔺 绿色三角：买入点
- 🔻 红色三角：卖出点

**子图2: 成交量**
- 灰色柱状图：每日成交量

**子图3: 资产价值**
- 绿色区域：资产价值变化
- 灰色虚线：初始资金$10,000

### 交易记录表

显示所有交易的详细信息：
- **日期**: 交易日期
- **类型**: BUY（买入）/ SELL（卖出）
- **价格**: 交易价格
- **盈亏**: 该笔交易的盈亏金额
- **盈亏%**: 该笔交易的盈亏百分比

---

## 🎓 最佳实践

### 1. 参数优化流程

**步骤1**: 使用默认参数进行初步测试
```
币种: BTC-USD
周期: 6mo
策略: RSI均值回归
参数: 默认
```

**步骤2**: 查看结果，分析问题
- 交易次数太少？ → 放宽超买超卖线
- 交易次数太多？ → 收紧超买超卖线
- 胜率太低？ → 调整参数或换策略

**步骤3**: 微调参数
- 每次只调整一个参数
- 记录每次的结果
- 找到最优组合

**步骤4**: 多币种验证
- 在其他币种上测试相同参数
- 确保策略的稳健性

### 2. 策略选择建议

**比特币 (BTC-USD)**:
- 推荐策略: RSI均值回归、MACD
- 周期: 6个月以上
- 特点: 相对稳定，适合中长期策略

**以太坊 (ETH-USD)**:
- 推荐策略: RSI均值回归、移动平均线
- 周期: 3-6个月
- 特点: 波动较大，注意风控

**币安币 (BNB-USD)**:
- 推荐策略: 动量突破、MACD
- 周期: 3个月
- 特点: 趋势性强

**Solana (SOL-USD)**:
- 推荐策略: 布林带、动量突破
- 周期: 1-3个月
- 特点: 高波动，高风险高收益

**狗狗币 (DOGE-USD)**:
- 推荐策略: RSI均值回归、布林带
- 周期: 1-3个月
- 特点: 极度波动，娱乐为主

### 3. 风险控制

- ⚠️ **永远不要用全部资金交易**
- ⚠️ **设置止损止盈**（系统暂不支持，需手动）
- ⚠️ **分散投资**，不要只用一个策略或一个币种
- ⚠️ **历史表现≠未来收益**
- ⚠️ **回测有过拟合风险**

### 4. 常见问题

**Q: 为什么交易次数是0？**
A: 可能是：
- 参数设置太严格，没有触发信号
- 周期太短，数据不足
- 该币种在此期间没有符合条件的机会

解决方法：放宽参数，增加周期

**Q: 为什么收益率是负数？**
A: 这是正常的，说明该策略在这个时期不适用。尝试：
- 更换策略
- 调整参数
- 更换币种或周期

**Q: 如何判断策略是否过拟合？**
A:
- 在不同周期测试（1mo, 3mo, 6mo）
- 在不同币种测试
- 如果结果差异巨大，可能过拟合

**Q: 买入持有收益更高，为什么还要用策略？**
A:
- 策略可以降低回撤
- 策略可以控制风险
- 在某些市场环境下策略更优
- 实盘中很难做到买入持有

---

## 🔧 技术说明

### 回测假设

1. **初始资金**: $10,000
2. **手续费**: 0.1%（买入和卖出各收取）
3. **滑点**: 不考虑
4. **成交假设**: 按收盘价全部成交
5. **持仓**: 每次全仓买入，不支持分批建仓
6. **强制平仓**: 回测结束时如果持有仓位，按最后收盘价卖出

### 技术指标计算

- **RSI**: 14期相对强弱指数
- **MA**: 简单移动平均
- **布林带**: 20期MA ± 2倍标准差
- **MACD**: 12/26/9 EMA
- **成交量**: 来自Yahoo Finance

### 数据来源

使用 Yahoo Finance API (`yfinance`)，数据更新频率：
- 实时数据有15-20分钟延迟
- 历史数据完整准确
- 如遇网络问题，系统会缓存数据1小时

---

## 📞 获取帮助

### 日志查看

如果遇到问题，查看终端输出的错误信息。

### 重启应用

按 `Ctrl+C` 停止，然后重新运行：
```bash
./run_interactive.sh
```

### 清除缓存

如果数据异常，清除缓存：
```bash
# 在浏览器中按 C 键
# 或在终端中按 Ctrl+C 停止后重启
```

---

## 🎯 下一步

1. ✅ **掌握基础**: 先用默认参数测试各个策略
2. ✅ **参数优化**: 找到适合每个币种的最佳参数
3. ✅ **策略组合**: 记录表现好的策略和参数
4. ✅ **实盘验证**: 用小资金在实盘验证（谨慎！）
5. ✅ **持续优化**: 市场在变化，策略也要调整

---

## ⚠️ 免责声明

**本系统仅供学习和研究使用，不构成任何投资建议。**

- 历史表现不代表未来收益
- 回测结果可能存在过拟合
- 实盘交易存在额外成本（滑点、深度、手续费波动等）
- 加密货币市场波动极大，投资需谨慎
- 永远不要投入无法承受损失的资金

**祝你交易顺利！** 📈✨
